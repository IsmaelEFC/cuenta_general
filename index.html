<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#006341" />
  <meta name="description" content="Aplicación para el control de personal del Departamento de Investigación de Organizaciones Criminales" />
  <!-- PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Cuenta OS9">
  <link rel="manifest" href="./manifest.json" />
  <link rel="shortcut icon" href="./icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <link rel="icon" href="./icons/icon-192.png" sizes="192x192" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo"><img src="./icons/os9.png" alt="OS9 Logo" class="logo-img"></div>
      <h1>Cuenta Diaria</h1>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <!-- Contenido principal de la aplicación -->
      <div id="contenedor">
        <!-- Las secciones se generarán dinámicamente aquí -->
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="total-general" id="totalGeneralFooter">
        Personal formando: <span id="totalGeneral">0</span>
      </div>
      <div class="button-group">
        <button id="resetear-dia" class="reset-btn">Reiniciar Día</button>
        <button id="generar-informe" class="report-btn">Generar Informe Final</button>
      </div>
    </div>
  </footer>

  <!-- Modal de Informe -->
  <div id="modalInforme" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Cuenta General</h2>
        <div class="fecha-informe" id="fechaInforme"></div>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body" id="informeContenido">
        <!-- Contenido del informe se generará dinámicamente -->
      </div>
      <div class="modal-footer">
        <button class="export-pdf-btn" id="exportar-pdf">Exportar a PDF</button>
        <button class="share-whatsapp-btn" id="compartir-whatsapp">Compartir por WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- Contenedor oculto para la generación de PDF -->
  <div id="pdfContainer" class="pdf-container"></div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="pwa-install.js"></script>
  <script src="script.js"></script>
  
  <!-- Inicialización de la aplicación -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar jsPDF
      try {
        if (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) {
          window.jsPDF = window.jspdf.jsPDF;
          console.log('jsPDF inicializado correctamente');
        } else if (typeof jsPDF !== 'undefined') {
          window.jsPDF = jsPDF;
          console.log('jsPDF inicializado desde el objeto global');
        } else {
          console.error('No se encontró la biblioteca jsPDF');
        }
      } catch (error) {
        console.error('Error al inicializar jsPDF:', error);
      }
      
      // Configurar event listeners
      const resetearBtn = document.getElementById('resetear');
      const generarInformeBtn = document.getElementById('generar-informe');
      const cerrarModalBtn = document.querySelector('.close');
      const exportarPdfBtn = document.getElementById('exportar-pdf');
      const compartirWhatsappBtn = document.getElementById('compartir-whatsapp');
      
      if (resetearBtn) resetearBtn.addEventListener('click', resetear);
      if (generarInformeBtn) generarInformeBtn.addEventListener('click', abrirInforme);
      if (cerrarModalBtn) cerrarModalBtn.addEventListener('click', cerrarInforme);
      if (exportarPdfBtn) exportarPdfBtn.addEventListener('click', exportarPDF);
      if (compartirWhatsappBtn) compartirWhatsappBtn.addEventListener('click', compartirWhatsapp);
      
      // Cerrar modal al hacer clic fuera del contenido
      const modal = document.getElementById('modalInforme');
      if (modal) {
        window.addEventListener('click', (event) => {
          if (event.target === modal) {
            cerrarInforme();
          }
        });
      }
    });
  </script>
</body>
</html>
